<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>工作流工厂测试版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css"> 
    <!-- 必须加这行！否则炼丹炉无法获取最新 Token -->
</head>
<body>
    <!-- 顶部控制栏 -->
    <header class="test-header">
        <h1><i class="fas fa-flask"></i> 工作流工厂测试版</h1>
        <div class="test-controls">
            <button id="btn-reset">重置</button>
            <button id="btn-export">导出配置</button>
            <button id="btn-simulate">模拟数据</button>
            <button id="btn-back" onclick="window.location.href='https://0o0o0.shop/index.html'">返回主系统</button>
        </div>
    </header>
    const API_BASE = 'https://public-virid-chi.vercel.app';
    <!-- 三栏主容器 -->
    <div class="factory-container">
        <!-- 左侧：角色零件库 -->
        <aside class="panel library-panel">
            <div class="panel-header">
                <h3><i class="fas fa-box-open"></i> 角色零件库</h3>
                <div class="panel-tools">
                    <button class="btn-icon" title="新建分类" onclick="addNewCategory()"><i class="fas fa-folder-plus"></i></button>
                    <button class="btn-icon" title="搜索" onclick="toggleSearch()"><i class="fas fa-search"></i></button>
                </div>
            </div>
            
            <!-- 零件网格 -->
            <div class="parts-grid-container">
                <div class="parts-grid" id="parts-grid"></div>
            </div>
        </aside>
        
      <!-- 中间：工作流组装台 -->
<main class="panel builder-panel">
    <div class="panel-header">
        <h3><i class="fas fa-drafting-compass"></i> 工作流组装台</h3>
        <div class="workflow-tools">
            <button id="btn-auto-orchestrate" class="btn-primary-glow">
                <i class="fas fa-magic"></i> AI 自动编排
            </button>  
            <button id="btn-add-group" title="新建分组">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    </div>
    
    <!-- 工作流主区域（可滚动） -->
    <div class="workflow-content">
        <!-- 分组容器 -->
        <div class="groups-container" id="groups-container">
            <!-- 分组将在这里动态创建 -->
        </div>
    </div>
    
    <!-- 炼丹炉（固定在底部） -->
    <div class="drop-hint" id="drop-hint">
        <i class="fas fa-arrow-down"></i>
        <p>从左侧拖拽角色到此处，或从右侧拖拽AI模型进行绑定</p>
        <p style="font-size: 12px; color: #94a3b8;">炼丹炉现在应该始终可见，不会随内容滚动而消失</p>
    </div>
</main>
        
        <!-- 右侧：AI引擎库 -->
        <aside class="panel ai-panel">
            <div class="panel-header">
                <h3><i class="fas fa-brain"></i> AI引擎库</h3>
                <div class="panel-tools">
                    <button class="btn-icon" title="添加模型" onclick="addCustomModel()"><i class="fas fa-plus-circle"></i></button>
                    <button class="btn-icon" title="刷新" onclick="refreshModels()"><i class="fas fa-sync-alt"></i></button>
                </div>
            </div>
            
            <!-- AI分类 -->
            <div class="ai-categories" id="ai-categories"></div>
            
            <!-- 绑定状态面板 -->
            <div class="binding-panel">
                <h4><i class="fas fa-link"></i> 当前绑定状态</h4>
                <div class="binding-list" id="binding-list"></div>
                <div class="binding-stats">
                    <div class="stat-item">
                        <span class="stat-label">已绑定角色</span>
                        <span class="stat-value" id="bound-roles-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">使用模型</span>
                        <span class="stat-value" id="used-models-count">0</span>
                    </div>
                </div>
            </div>
        </aside>
    </div>
    
    <!-- API配置模态框 -->
    <div id="api-config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plug"></i> API配置</h3>
                <button class="btn-close" onclick="hideApiConfigModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="api-config-form">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> 角色名称</label>
                        <input type="text" id="config-role-name" readonly>
                        <input type="hidden" id="config-role-id">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-key"></i> API类型</label>
                        <select id="api-type">
                            <option value="openai">OpenAI API</option>
                            <option value="deepseek">DeepSeek API</option>
                            <option value="anthropic">Anthropic Claude</option>
                            <option value="google">Google Gemini</option>
                            <option value="custom">自定义API</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-link"></i> API端点</label>
                        <input type="text" id="api-endpoint" placeholder="https://api.openai.com/v1/chat/completions">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-key"></i> API密钥</label>
                        <input type="password" id="api-key" placeholder="sk-...">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-sliders-h"></i> 模型名称</label>
                        <input type="text" id="api-model" placeholder="gpt-4-turbo">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-temperature-high"></i> 温度</label>
                        <input type="range" id="api-temperature" min="0" max="1" step="0.1" value="0.7">
                        <span id="temp-value">0.7</span>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-tasks"></i> 系统指令</label>
                        <textarea id="api-system-prompt" rows="3" placeholder="你是一个专业的..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="testApiConnection()">
                    <i class="fas fa-test"></i> 测试连接
                </button>
                <button type="button" class="btn-secondary" onclick="hideApiConfigModal()">取消</button>
                <button type="button" class="btn-primary" onclick="saveApiConfig()">保存配置</button>
            </div>
        </div>
    </div>
    
   <!-- 放在body标签内的任意位置 -->
<div class="debug-float-container" id="debug-float-container">
    <!-- 调试按钮 -->
    <div class="debug-handle" id="debug-handle">
        <i class="fas fa-bug"></i>
        <span class="debug-badge" id="debug-badge">0</span>
    </div>
    
    <!-- 调试面板 -->
    <div class="debug-panel">
        <div class="debug-header">
            <div class="debug-title">
                <i class="fas fa-bug"></i> 调试信息
                <span id="debug-count">0</span>
            </div>
            <div class="debug-controls">
                <button class="debug-btn debug-clear" onclick="clearDebugLog(event)">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="debug-btn debug-pin" onclick="togglePinDebugPanel()">
                    <i class="fas fa-thumbtack"></i>
                </button>
                <button class="debug-btn debug-close" onclick="toggleDebugPanel()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="debug-body">
            <div class="debug-log" id="debug-log"></div>
        </div>
    </div>
</div>
     <!-- 运行控制面板 -->
<div class="run-control-panel">
    <div class="run-controls">
        <button id="btn-run-all" class="btn-run-primary">
            <i class="fas fa-play-circle"></i> 运行全部
        </button>
        <button id="btn-run-group" class="btn-run-secondary">
            <i class="fas fa-play"></i> 运行选中组
        </button>
        <button id="btn-run-step" class="btn-run-secondary">
            <i class="fas fa-step-forward"></i> 单步执行
        </button>
        <button id="btn-stop" class="btn-run-stop" disabled>
            <i class="fas fa-stop"></i> 停止
        </button>
        
        <div class="run-status">
            <span id="run-status-text">就绪</span>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <span id="progress-text">0%</span>
        </div>
    </div>
</div>

<!-- 执行结果面板 -->
<div class="results-panel" id="results-panel">
    <div class="results-header">
        <h3><i class="fas fa-history"></i> 执行结果</h3>
        <button onclick="toggleResultsPanel()" class="btn-icon">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="results-content" id="results-content">
        <!-- 执行结果将动态显示在这里 -->
    </div>
</div>
     <!<!-- 1. 引入 SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- 2. 初始化 Supabase (这一步必须在 api.js 之前！) -->
<script>
    // 你的 Supabase 配置
    const SUPABASE_URL = 'https://uispjsahipixbocvfdrg.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_qgH5KWfpLwYRpdCDmdVoTQ_6tAl3pG9'; // 你的 Key

    // 初始化客户端并挂载到 window
    if (window.supabase) {
        window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // 关键：为了兼容 api.js 的写法 (window.supabase.auth...)
        window.supabase = window.supabaseClient;
        
        console.log("✅ Supabase SDK 已就绪 (炼丹炉)");
    } else {
        console.error("❌ SDK 加载失败，请检查网络");
    }
</script>
      <script src="js/modules/alchemy_core.js"></script>
      <script src="js/config/role-parts-library.js"></script>
      
    <script src="js/alchemy-animation.js"></script>
    <script type="module">
    import api from './js/api.js';
    // 把 api 挂载到全局，因为你的 main.js 以前是写在全局作用域的
    window.api = api; 
    window.chatAPI = api.chatAPI;
</script>
<script src="js/modules/role_generation.js"></script>    
<script type="module" src="js/main.js"></script>
<script src="/factory-bridge.js"></script>
<script src="./js/modules/factory-warehouse-bridge.js"></script> 

</body>

</html>















