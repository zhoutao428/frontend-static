<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI Workbench Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 1. æ ·å¼åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">

    <!-- 2. å†…è”æ ·å¼ (æ¨¡å‹é€‰æ‹©å™¨) -->
    <style>
        .model-selector-wrapper {
            display: flex; align-items: center; gap: 8px; 
            background: rgba(99, 102, 241, 0.1);
            padding: 4px 12px; border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.3);
            margin-left: 10px;
        }
        .model-selector-wrapper i { color: #a5b4fc; }
        #global-model-select {
            background: transparent; color: #e0e7ff; border: none; font-size: 13px; font-weight: 600; cursor: pointer;
        }
        #global-model-select option { background: #1e1b4b; color: white; }
    </style>
    
    <!-- âœ… 3. å¼•å…¥ Supabase SDK (å¿…é¡»æ”¾åœ¨ Head é‡Œæˆ–è€… Body æœ€ä¸Šé¢) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- âœ… 4. åˆå§‹åŒ– Supabase (è¿™ä¸€æ­¥æœ€å…³é”®ï¼) -->
    <script>
        const SUPABASE_URL = 'https://uispjsahipixbocvfdrg.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_qgH5KWfpLwYRpdCDmdVoTQ_6tAl3pG9'; // ä½ çš„ Key
        
        // åˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶æŒ‚è½½åˆ° window
        if (window.supabase) {
            window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            // ä¸ºäº†å…¼å®¹ api.js çš„å†™æ³• (window.supabase.auth...)
            // æˆ‘ä»¬æŠŠ createClient çš„åŸå§‹å¯¹è±¡è¦†ç›–å›å»ï¼Œæˆ–è€…æ˜¯åšä¸€ä¸ªä»£ç†
            // æœ€ç¨³å¦¥çš„å†™æ³•æ˜¯ï¼šè®© window.supabase æŒ‡å‘ client å®ä¾‹
            window.supabase = window.supabaseClient;
            
            console.log("âœ… Supabase SDK å·²å°±ç»ª (Index)");
        } else {
            console.error("âŒ SDK åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ");
        }
    </script>
</head>

<body>
    <!-- === é¡¶éƒ¨å¯¼èˆªæ  === -->
    <header class="top-bar">
        <!-- å·¦ä¾§ï¼šå“ç‰Œä¸é¡¹ç›® -->
        <div class="left-section">
            <div class="brand">
                <i class="fas fa-network-wired"></i>
                <span class="brand-text">Workbench</span>
            </div>
            <div class="divider-v"></div>
            
            <!-- é¡¹ç›®æ§åˆ¶ -->
            <div class="project-controls">
                <div class="select-wrapper">
                    <i class="fas fa-cube"></i>
                    <select id="global-project-select">
                        <option value="">åŠ è½½ä¸­...</option>
                    </select>
                </div>
                <button class="btn-icon-only" id="btn-new-project" title="æ–°å»ºäº‘ç«¯é¡¹ç›®">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="btn-icon-only" id="btn-open-local" title="æŒ‚è½½æœ¬åœ°ä»£ç ">
                    <i class="fas fa-folder-open"></i>
                </button>
            </div>
        </div>

        <!-- ä¸­é—´ï¼šæ¨¡å‹æ§åˆ¶ -->
        <div class="center-section">
            <div class="model-selector-wrapper">
                <i class="fas fa-microchip"></i>
                <select id="global-model-select">
                    <option disabled>åŠ è½½æ¨¡å‹...</option>
                </select>
            </div>
        </div>

        <!-- å³ä¾§ï¼šå…¨å±€æ§åˆ¶ -->
        <div class="right-section top-controls">
            <!-- è§†å›¾åˆ‡æ¢ -->
            <button class="btn-icon-text" id="view-mode-btn" title="åˆ‡æ¢è§†å›¾">
                <i class="fas fa-th-large"></i> ä¹å®«æ ¼
            </button>
            <div class="divider-v"></div>

            <!-- åŠŸèƒ½ä¸­å¿ƒ -->
            <div class="dropdown-trigger">
                <button class="btn-icon-text" id="features-btn">
                    <i class="fas fa-cube"></i> åŠŸèƒ½ä¸­å¿ƒ
                </button>
                <div id="features-menu" class="dropdown-menu" style="min-width: 200px;">
                    <div class="menu-header">
                        <div style="font-weight:bold; color:white;">åŠŸèƒ½ä¸­å¿ƒ</div>
                    </div>
                    <div class="menu-divider"></div>
                    <!-- ä¿®å¤é“¾æ¥è·¯å¾„ -->
                    <a href="workflow-test/workflow-factory-test.html" class="menu-item">
                        <i class="fas fa-user-tie"></i> è§’è‰²ç®¡ç†
                    </a>
                    <a href="workflows/workflow-center.html" class="menu-item">
                        <i class="fas fa-sitemap"></i> ğŸš€ å·¥ä½œæµä¸­å¿ƒ
                    </a>
                    <a href="warehouse.html" class="menu-item">
                        <i class="fas fa-brain"></i> è§’è‰²ä»“åº“
                    </a>
                </div>
            </div>
            <div class="divider-v"></div>

            <!-- ç”¨æˆ·ä¸ªäººä¸­å¿ƒ -->
            <div id="user-profile-area" class="user-profile-wrapper">
                <!-- æœªç™»å½• -->
                <button id="login-btn" class="btn-primary-glow" onclick="window.location.href='login.html'">
                    ç™»å½• / æ³¨å†Œ
                </button>

                <!-- å·²ç™»å½• -->
                <div id="user-logged-in" class="user-pill" style="display:none;">
                    <div class="balance-tag">
                        <i class="fas fa-coins"></i> <span id="user-balance">--</span>
                    </div>
                    <div class="avatar-trigger" id="avatar-btn">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User">
                    </div>
                    
                    <!-- ç”¨æˆ·èœå• -->
                    <div class="dropdown-menu user-menu" id="user-menu">
                        <div class="menu-header">
                            <div class="user-name" id="user-name-display">Guest</div>
                            <div class="user-email" id="user-email-display">...</div>
                        </div>
                        <div class="menu-divider"></div>
                        <!-- ä¿®å¤æ­»é“¾ -->
                        <a href="javascript:alert('è´¦å•åŠŸèƒ½å¼€å‘ä¸­')" class="menu-item">
                            <i class="fas fa-credit-card"></i> æˆ‘çš„è´¦å•
                        </a>
                        <a href="config.html" class="menu-item">
                            <i class="fas fa-key"></i> è‡ªå®šä¹‰ Key
                        </a>
                        <div class="menu-divider"></div>
                        <a href="#" id="logout-btn" class="menu-item danger">
                            <i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- === ä¸»å·¥ä½œåŒº === -->
    <div class="workspace">
        <aside class="sidebar" id="sidebar-area">
            <!-- ä¾§è¾¹æ å†…å®¹ç”± JS ç”Ÿæˆ -->
        </aside>
        <main class="stage" id="main-stage">
            <div class="empty-state" style="display:none;">
                <i class="fas fa-layer-group"></i>
                <p>ä»å·¦ä¾§æ‹–æ‹½æ™ºèƒ½ä½“åˆ°æ­¤å¤„å¼€å§‹åä½œ</p>
            </div>
        </main>
    </div>

    <!-- === åº•éƒ¨æ§åˆ¶å° === -->
    <div class="console-panel">
        <div class="console-header" id="console-header">
            <span><i class="fas fa-terminal"></i> TERMINAL / SYSTEM LOG</span>
            <div class="right-tools">
                <i class="fas fa-eraser" id="btn-clear-console" title="æ¸…ç©º"></i>
                <i class="fas fa-chevron-down" id="console-toggle-icon"></i>
            </div>
        </div>
        <div class="console-body">
            <div class="console-output" id="console-output">
                <div class="log-item info">ğŸš€ ç³»ç»Ÿæ ¸å¿ƒå·²åŠ è½½ [v2.0 Cyberpunk Edition]</div>
            </div>
            <div class="console-input-wrapper">
                <span class="prompt-char">âœ</span>
                <input type="text" id="console-cmd" placeholder="è¾“å…¥æŒ‡ä»¤ (e.g. @all report status)...">
            </div>
        </div>
    </div>

    <!-- === çª—å£æ±  (éšè—) === -->
    <div id="windows-pool" style="display:none;"></div>

    <!-- === æ¨¡æ€æ¡† === -->
    <div id="custom-modal" class="modal-backdrop" style="display:none;">
        <div class="modal-panel">
            <div class="modal-header">
                <h3 id="modal-title">è¯·è¾“å…¥</h3>
                <button class="btn-icon-only" id="btn-close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" style="padding: 20px 0;">
                <input type="text" id="modal-input" class="modal-input" autocomplete="off">
            </div>
            <div class="modal-footer" style="display:flex; justify-content:flex-end; gap:10px;">
                <button class="btn btn-ghost" id="btn-cancel-modal">å–æ¶ˆ</button>
                <button class="btn btn-primary-glow" id="modal-confirm">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- âœ… 5. å¼•å…¥ä¸šåŠ¡è„šæœ¬ (Strict Order) -->
    <!-- æ³¨æ„ï¼šä¸è¦é‡å¤å¼•ç”¨ main.js (åŸä»£ç å¼•ç”¨äº†ä¸¤æ¬¡) -->
    
    <script src="./js/warehouse-bridge.js"></script>
    
    <!-- è¿™é‡Œä½¿ç”¨ type="module" æ˜¯å› ä¸º ui.js å’Œ main.js é‡Œç”¨äº† import/export -->
    <!-- api.js ä¸éœ€è¦æ˜¾å¼å¼•å…¥ï¼Œå› ä¸º main.js å†…éƒ¨ä¼š import å®ƒ -->
    <script type="module" src="./js/ui.js"></script>
    <script type="module" src="./js/main.js"></script>
    
    <!-- ä¸´æ—¶è„šæœ¬ (å¯ä¿ç•™ä¹Ÿå¯æ”¾å…¥ main.js) -->
    <script>
        // å®šä¹‰å…¨å±€å˜é‡ä»¥å…¼å®¹æ—§ä»£ç 
        window.API_BASE_URL = 'https://public-virid-chi.vercel.app/api';

        function startContentWorkflow() {
            console.log('ğŸš€ å¯åŠ¨ä¸€é”®å†…å®¹åˆ›ä½œå·¥ä½œæµ');
            document.getElementById('features-menu').style.display = 'none';
            alert('ğŸ¬ ä¸€é”®å†…å®¹åˆ›ä½œå·¥ä½œæµå·²å¯åŠ¨ï¼');
        }
        function startDataAnalysisWorkflow() {
            console.log('ğŸ“Š å¯åŠ¨æ•°æ®åˆ†æå·¥ä½œæµ');
            document.getElementById('features-menu').style.display = 'none';
            alert('ğŸ“ˆ æ•°æ®åˆ†æå·¥ä½œæµå·²å¯åŠ¨ï¼');
        }
    </script>
</body>
</html>
